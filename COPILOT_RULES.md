# Copilot/AIアシスタント用 コーディングルール

このドキュメントは、GitHub CopilotやAIアシスタントが本プロジェクトでコード生成・提案を行う際に必ず従うべきルールをまとめたものです。

---

## 1. 基本ルール

- AIの回答は日本語で記述すること。
- 生成された、コード内のメッセージやコメントは英語を使うこと。
- TypeScriptでは型・インターフェースを必ず定義し、`any`は禁止（`unknown`を使う）。
- UIコンポーネントには必ず`id`属性を付与し、テスト可能性を担保すること。
- npm, npxコマンドは実行しない pnpm exec を使う。
- AIはパッケージを新規で導入する場合、必ずpackage.jsonをチェックして、既に入ってるか確認すること。
- AIがユーザーの環境でコマンドを提案・実行する際、必ず事前に`pwd`や`ls -al`で現在の作業ディレクトリやファイル構成を確認し、 誤ったパスや意図しない場所での操作を防ぐこと。
- ルートディレクトリは編集禁止。コードに限らず、フォルダを作る際も踏襲してください。
  - React/UI関連は`frontend/`配下
  - DB/データマイニング/データ操作系は`backend/`配下

---

## 2. コーディングスタイル

- フロントエンド（React/TypeScript）はPascalCaseファイル名、関数名はcamelCase、インターフェース名は`I`接頭辞。
- バックエンド（Node.js/TypeScript）はkebab-caseファイル名、クラス名はPascalCase、関数名はcamelCase。
- すべての非同期処理はtry/catchでエラーハンドリングを行う。
- 行長は100文字以内、インデントは2スペース、strictモード必須。

---

## 3. テスト規約

- テストファイルは`Test/`配下に配置し、`[用途]/[ファイル名].test.ts`形式とする。
- テスト名・コメントは英語で記述。
- 機能部分は80%以上のカバレッジを目指す。
- Mockを活用し、DBやAPIへの実書き込みは禁止。
- テストのためだけに元コードを改変しない（id属性追加は例外）。
- ユニットテストを重視し、各関数・クラス・コンポーネント単位で独立して検証すること。
- ユニットテストでは外部依存（DB・API・ファイルIO等）は必ずMock化し、純粋なロジックのみを検証すること。
- ユニットテストの失敗は即座に修正し、CIでの自動実行を必須とする。

---

### 単体テスト（ユニットテスト）の観点

- UIコンポーネントの単体テストでは、以下を必ず検証すること：
  - レンダリング（テキスト・画像・条件分岐表示）
  - ユーザー操作（クリック・入力・キーボード操作等）のシミュレーション
  - Props/State/Hookによる状態変化・再レンダリング
  - アクセシビリティ（ARIA属性・キーボード操作）

- 関数の単体テストでは、以下を必ず検証すること：
  - 入力バリデーション（正常系・異常系・例外）
  - 境界値・オフバイワン
  - 分岐カバレッジ（if/switch/ガード節）
  - 副作用・例外処理のモック化
  - パラメタライズドテスト（複数入力パターン）

- 例外・エラーパス検証も重視し、期待例外・catch/finallyの動作・状態復元をテストすること。

- モック/スタブは外部依存（DB/ファイルI/O等）を排除し、状態検証・振る舞い検証を明確に分けて使うこと。

---

## 4. フロントエンド実装ルール

- 外部の状態管理ライブラリを導入しない。React Contextのみで行う事
- レスポンシブ対応は`react-responsive`、フォームは`react-hook-form`+`zod`、api通信時は`react-query`, `axios`を常に使用。
- 多言語対応は`i18next`を使い、全テキストは翻訳キー経由で表示すること。
- tailwindでテーマを指定しています。frontend/tailwind.config.tsを参考にclassName指定をしてください。
- 多言語ファイルは`src/locales/[locale].json`形式、en/ja/cn/kr/de/fr/pt/es/nlに対応。
- 文字列のハードコーディングは禁止。

---

## 5. バックエンドAPI設計ルール

- 原則的にAPIのエラーレスポンスは英語のメッセージを返す事。
- すべてのAPIはOpenAPI仕様に準拠し、JSDocコメントで仕様を記述する。
- Prisma Clientを使い、トランザクション・エラーハンドリングを徹底。
- 入力検証はzodで厳密に行う。
- 機密情報は必ず環境変数で管理。

---

## 6. セキュリティ・パフォーマンス

- すべてのユーザー入力は検証し、認証・権限チェックを徹底。
- XSS/CSRF/SQLインジェクション等のOWASP対策を必ず実施。
- 依存パッケージは定期的に更新し、セキュリティパッチを適用。
- DBクエリ最適化・キャッシュ活用・バンドルサイズ縮小・遅延ロード・アセット圧縮を意識する。

---

## 7. ドキュメント

- API仕様はOpenAPI形式、関数コメントはJSDoc形式（英語）で記載。
- MarkdownはmarkdownLint準拠。

---

## 8. 開発フロー・Git管理

- ブランチ戦略は`main`（本番）→`release`→`develop`→`feature`/`fix`。
- 新しい機能追加は `feature/実際の機能名[チケット番号]` でブランチを作成すること。
- バグ修正のみの場合は `fix/修正内容[チケット番号]` でブランチを作成すること。
- コミットメッセージはConventional Commits形式。
- PRはセルフレビュー・CI通過・ドキュメント更新・コードオーナーレビュー必須。

---

## 9. 開発ツール・環境設定

- ESLint/Prettier/EditorConfig/VSCode設定を必ず適用。
- パッケージ管理はpnpmを使用し、バージョン固定。

---

## 10. 追加ルール

- バックエンドAPIはOpenAPI（Swagger）仕様・JSDocコメントを徹底。
- すべての生成コードはレビュー・自動テスト・ドキュメント更新・セキュリティ対策を必須とする。

---

このルールに違反するコードや提案は一切行わないこと。  
常に最新のCOPILOT_RULES.mdを参照し、プロジェクトの品質を最優先とすること。

---
